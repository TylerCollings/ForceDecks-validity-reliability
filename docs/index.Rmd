---
pagetitle: "Reliability and Validity"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    css: app_data_manuscript/styles.css
    logo: images\FD_logo.png
editor_options: 
  chunk_output_type: console
---

```{r PREPARE WORKSPACE, include=FALSE}
library(flexdashboard)
library(knitr)
library(patchwork)
library(data.table)
library(scales)
library(plotly)
library(gt)
library(gtExtras)
library(readxl)
library(tidyverse)

source('rmba.R')

knitr::opts_chunk$set(dpi=68)

title.size = 10
text.size = 9

# Participant information
participant.info <- read_xlsx('FD reliability recruitment/participantData.xlsx') %>% 
  janitor::clean_names()

participant.table <- participant.info %>% 
  select(id, age, height, weight, time_between) %>% 
  pivot_longer(c(age, height, weight, time_between)) %>% 
  group_by(name) %>% 
  summarise(mean = mean(value),
            sd = sd(value),
            range = paste(round(range(value),1), collapse = '-')) %>% 
  mutate(name = factor(name, levels = c("age", "weight", "height", "time_between"))) %>% 
  arrange(name) %>% 
  mutate(name = str_replace_all(name, c('age' = 'Age (years)', 'weight' = 'Weight (kg)','height' = 'Height (cm)', 'time_between' = 'Days between tests'))) %>% 
  rename(c('Mean' = 'mean'), 'SD' = 'sd', 'Range' = 'range')

# LOAD EXCISTING DATA FILES
if(file.exists('app_data_manuscript/reliability_validity.RDS')){reliability_validity <- readRDS('app_data_manuscript/reliability_validity.RDS')}
if(file.exists('app_data_manuscript/discrete_data.RDS')){discrete.data <- readRDS('app_data_manuscript/discrete_data.RDS')}
if(file.exists('app_data_manuscript/GRF_data.RDS')){GRF.data <- readRDS('app_data_manuscript/GRF_data.RDS')}
if(file.exists('app_data_manuscript/data_metrics.RDS')){data.metrics<- readRDS('app_data_manuscript/data_metrics.RDS')}
if(file.exists('app_data_manuscript/data_phases.RDS')){data.phases<- readRDS('app_data_manuscript/data_phases.RDS')}

metric.list <- read_xlsx('app_data_manuscript/metric_list.xlsx') %>% filter(include_in_manuscript)

col.gradient <- paletteer::paletteer_c("grDevices::ag_GrnYl", 4)
cols <- c('FD' = '#FF7A00', 'AMTI' = col.gradient[1], 
          'ForceDecks' = '#FF7A00', 'Laboratory' = col.gradient[1],
          'day1' = 'steelblue', 'day2' = 'firebrick3', 
          'TRUE' = 'forestgreen', 'FALSE' = 'firebrick3')

# Height of table rows
table.height <- reliability_validity %>% 
  count(test_type) %>% 
  mutate(height = 5.5 + (n-10)/3) %>% 
  select(-n) %>% 
  deframe()

# Order of tasks according to HTML report menu
task.order <- c('Countermovement Jump', 'Squat Jump', 'Drop Jump', 'Hop Test', 'Single Leg Hop Test', 'Isometric Mid-Thigh Pull',
                'Shoulder ISO-I', 'Shoulder ISO-T', 'Shoulder ISO-Y', 'Squat Assessment', 'Quiet Stand', 'Single Leg Range of Stability')

```

```{r CREATE TABLE FUNCTION}
metricTable <- function(data, select_test_type, table.size = 10) {
  # data = reliability_validity
  # select_test_type = "Isometric Mid-Thigh Pull"
  
  df.table <- data %>% 
    filter(test_type == select_test_type) %>% 
    select(metric, ICC_group_FD, ICC_FD, ICC_lower_FD, ICC_upper_FD, SEM_FD, MDC_FD, PDiff_group, PDiff) %>% 
    mutate(unit = str_extract(metric,'\\[(.*?)\\]') %>% str_remove('\\[') %>% str_remove('\\]') %>% str_replace_na('')) %>% 
    filter(!is.na(ICC_FD))
  
  gt(df.table) %>% 
    opt_interactive(
      page_size_default = nrow(df.table),
      #use_search = T,
      use_pagination = F,
      use_pagination_info = F,
      use_filters = T,
      use_highlight = T,
      use_compact_mode = T,
      use_page_size_select = F
    ) %>% 
    opt_table_font(
      font = "Arial, sans-serif") %>% 
    fmt_number(
      columns = c(ICC_FD, ICC_lower_FD, ICC_upper_FD, SEM_FD, MDC_FD),
      decimals = 2) %>% 
    fmt_number(
      columns = SEM_FD,
      rows = abs(SEM_FD) > 10,
      decimals = 0) %>% 
    fmt_percent(
      columns = c(PDiff), 
      decimals = 0,
      scale_values = F) %>%
    fmt_number(
      columns = MDC_FD,
      rows = abs(MDC_FD) > 10,
      decimals = 0) %>% 
    cols_label(
      metric = "<b>Metric</b>",
      ICC_group_FD = '<b>Reliability</b>',
      ICC_FD = '<b>ICC</b><br>repeatability between-days (0-1)',
      ICC_lower_FD = '<b>ICC</b><br>95% confidence interval',
      SEM_FD = '<b>SEM</b><br>standard error of measurement',
      MDC_FD = '<b>MDC</b><br>minimal detectable change',
      PDiff_group = '<b>Validity</b>',
      PDiff = '<b>Agreement</b><br>% different to lab forceplate',
      .fn = md) %>% 
    cols_width(
      metric ~ px(380), 
      ICC_group_FD ~ px(130),
      ICC_FD ~ px(140),
      ICC_lower_FD ~ px(140),
      SEM_FD ~ px(140),
      MDC_FD ~ px(140),
      PDiff_group ~ px(130),
      PDiff ~ px(130)) %>% 
    cols_align(
      columns = -metric,
      align = 'center') %>% 
    cols_merge(
      columns = c(ICC_lower_FD, ICC_upper_FD),
      pattern = '{1}-{2}') %>% 
    cols_merge(
      columns = c(SEM_FD, unit),
      pattern = '{1} {2}') %>% 
    cols_merge(
      columns = c(MDC_FD, unit),
      pattern = '{1} {2}') %>% 
    # tab_style(
    #   locations = cells_body(columns = c(ICC, PDiff)),
    #   style = list(cell_text(weight = "bold"))) %>% 
    data_color(
      columns = ICC_group_FD,
      palette = rev(as.character(col.gradient))) %>% 
    data_color(
      columns = PDiff_group,
      palette = as.character(col.gradient))
  
}
```

```{r CREATE SUMMARY FIGURES}

summaryReliabiltyBar <- function(data, select_test_type) {
  # data = reliability_validity
  # select_test_type = "Isometric Mid-Thigh Pull"
  
  group.labels <- c("Excellent" = "Excellent<br> <span style='font-size: 16px'>ICC>0.9</span>",
                    "Good" = "Good<br> <span style='font-size: 16px'>ICC=0.75-0.9</span>",
                    "Moderate" = "Moderate<br> <span style='font-size: 16px'>ICC=0.5-0.75</span>",
                    "Poor" = "Poor<br> <span style='font-size: 16px'>ICC<0.5</span>")

  df.plot <- data %>% 
    filter(test_type == select_test_type) %>% 
    mutate(ICC_group_FD = str_replace_all(ICC_group_FD, group.labels) %>% factor(group.labels))

  
  ## Bar plot
  ggplot(df.plot) + aes(x = ICC_group_FD, fill = ICC_group_FD) + 
    geom_bar() +
    geom_text(aes(label = scales::percent(after_stat(count)/sum(after_stat(count)))), stat = 'count', 
              vjust = -0.5, size = (text.size)/.pt) + 
    coord_cartesian(clip = 'off') +
    scale_x_discrete(drop = FALSE) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(8)) +
    scale_fill_manual(values = col.gradient) +
    ylab('Number of metrics') +
    theme_classic() +
    theme(plot.margin = margin(t = 1.5, unit = 'lines'),
          legend.position = 'none',
          text = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.text.x = ggtext::element_markdown(),
          axis.title = element_text(size = title.size),
          axis.title.x = element_blank())
}

summaryValidityBar <- function(data, select_test_type) {
  # data = reliability_validity
  # select_test_type = "Countermovement Jump"
  
  group.labels <- c("Excellent" = "Excellent<br> <span style='font-size: 16px'><5%</span>",
                    "Good" = "Good<br> <span style='font-size: 16px'>5-10%</span>",
                    "Moderate" = "Moderate<br> <span style='font-size: 16px'>10-20%</span>",
                    "Poor" = "Poor<br> <span style='font-size: 16px'>>20%</span>")
  
  df.plot <- data %>% 
    filter(test_type == select_test_type) %>% 
    mutate(PDiff_group = str_replace_all(PDiff_group, group.labels) %>% factor(group.labels))
  
  ## Bar plot
  ggplot(df.plot) + aes(x = PDiff_group, fill = PDiff_group) + 
    geom_bar() +
    geom_text(aes(label = scales::percent(after_stat(count)/sum(after_stat(count)))), stat = 'count', 
              vjust = -0.5, size = (text.size)/.pt) + 
    coord_cartesian(clip = 'off') +
    scale_x_discrete(drop = FALSE) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(8)) +
    scale_fill_manual(values = col.gradient) +
    ylab('Number of metrics') +
    theme_classic() +
    theme(plot.margin = margin(t = 1.5, unit = 'lines'),
          legend.position = 'none',
          text = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.text.x = ggtext::element_markdown(),
          axis.title = element_text(size = title.size),
          axis.title.x = element_blank())
}

summarySwarm <- function(data, select_test_type) {
  # data = reliability_validity
  # select_test_type = "Drop Jump"
  
  rename.device = c('FD' = 'ForceDecks', 'AMTI' = 'Laboratory')
  
  df.plot <- data %>% 
    filter(test_type == select_test_type) %>% 
    select(metric, ICC_FD, ICC_AMTI) %>% 
    pivot_longer(c(ICC_FD, ICC_AMTI), names_to = c(NA,'device'), names_sep = '_', values_to = 'ICC') %>% 
    mutate(device = str_replace_all(device, rename.device) %>% factor(levels = rename.device))
  
  df.stat <- df.plot %>% 
    pivot_wider(names_from = device, values_from = ICC) %>% 
    mutate(percent_change = (ForceDecks - `Laboratory`)/`Laboratory`*100) %>% 
    summarise(mean_percent_change = mean(percent_change)) %>% 
    mutate(x = 1.5, 
           y = 1,
           positive = mean_percent_change>0,
           label = paste0(ifelse(positive,'+',''),round(mean_percent_change,1),'%'))
  
  # ICC
  ggplot(df.plot) + aes(x = device, y = ICC, color = device) +
    ggbeeswarm::geom_beeswarm(cex = 3, size = 3) +
    # geom_text(data = df.stat, inherit.aes = F, aes(x = x, y = y, label = label, color = positive), hjust = 0.5, vjust = 0, size = (text.size+6)/.pt) +
    scale_y_continuous(limits = c(0,1), breaks = pretty_breaks(10)) +
    scale_color_manual(values =  cols) +
    coord_cartesian(clip = 'off') +
    ylab('Intraclass coefficient (ICC)') +
    theme_classic() +
    theme(
      plot.margin = margin(t = 1, unit = 'lines'),
      legend.position = 'none',
      text = element_text(size = text.size),
      axis.text = element_text(size = text.size),
      axis.title = element_text(size = title.size),
      axis.title.x = element_blank(),
      axis.ticks = element_blank())
  

}
```

```{r CREATE WAVEFORM COMPARISONS}
individualWaveformFigures <- function(data, select_test_type) {
  # data = GRF.data 
  # select_test_type = 'Shoulder ISO-Y'

  df.data <- data %>% 
    filter(test_type == select_test_type) %>% 
    select(athlete, test_type, device, day, rep, side, time_normalised, force) %>% 
    pivot_wider(names_from = device, values_from = force) %>% 
    group_by(test_type, day, athlete, rep, side) %>% 
    mutate(RMSE = sqrt(mean((FD - AMTI) ^ 2))) %>% ungroup %>% 
    mutate(percentile = percent_rank(RMSE),
           median_diff = abs(percentile - 0.5)) %>% 
    mutate(closest_percentile = case_when(
      percentile == min(percentile, na.rm = T) ~ 'Best trial',
      median_diff == min(median_diff, na.rm = T) ~ 'Median trial',
      percentile == max(percentile, na.rm = T) ~ 'Worst trial')) %>%
    mutate(closest_percentile = factor(closest_percentile, levels = c('Best trial', 'Median trial', 'Worst trial'))) %>% 
    na.omit() 
  
  device.list <- c('FD' = 'ForceDecks', 'AMTI' = 'Laboratory')
  
  df.plot <- df.data %>% 
    select(time_normalised, AMTI, FD, closest_percentile, RMSE) %>% 
    pivot_longer(c(AMTI, FD), names_to = 'device') %>% 
    mutate(device = str_replace_all(device, device.list) %>% factor(levels = device.list)) %>% 
    mutate(time_normalised_scaled = scales::rescale(time_normalised, c(0,1)))
  
  ggplot(df.plot) + aes(x = time_normalised_scaled, y = value, color = device, linetype = device) +
    facet_wrap(vars(closest_percentile), nrow = 1) +
    geom_line(linewidth = 1) +
    geom_text(data = df.plot %>% filter(time_normalised == 1 & device == 'ForceDecks'), inherit.aes = F, 
              aes(label = paste('RMSE =', round(RMSE,1), ' N')), 
              x = 0.5, y = Inf, hjust = 0.5, vjust = 1, size = (text.size)/.pt) +
    scale_x_continuous(breaks = pretty_breaks(5), labels = percent_format()) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(5), limits = c(min(df.plot$value), max(df.plot$value)*1.1)) +
    scale_linetype_manual(values = c('Laboratory' = 'longdash', 'ForceDecks' = 'solid')) +
    scale_color_manual(values = cols) +
    ylab('Vertical ground reaction force (N)') +
    xlab('Time') +
    theme_classic() +
    theme(panel.grid.major = element_line(),
          plot.margin = margin(t = 1),
          strip.background = element_blank(),
          strip.text = element_text(size = text.size+2),
          text = element_text(size = text.size),
          axis.title = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.ticks = element_blank(),
          legend.text = element_text(size = text.size),
          legend.title = element_blank(),
          plot.background = element_rect(fill = 'white', color ='white'))
}

individualCOPFigures <- function(data, select_test_type) {
  # data = GRF.data 
  # select_test_type = 'Quiet Stand'

  df.data <- data %>% 
    filter(test_type == select_test_type) %>% 
    select(athlete, test_type, device, day, side, rep, time_normalised, COPX,  COPY) %>% 
    pivot_wider(names_from = device, values_from = c(COPX,COPY)) %>% 
    group_by(test_type, day, athlete, side, rep) %>% 
    mutate(COPX_RMSE = sqrt(mean((COPX_AMTI - COPX_FD) ^ 2, na.rm = T)),
           COPY_RMSE = sqrt(mean((COPY_AMTI - COPX_FD) ^ 2, na.rm = T)),
           RMSE = (COPX_RMSE + COPY_RMSE)/2) %>% ungroup %>% 
    mutate(percentile = percent_rank(RMSE),
           median_diff = abs(percentile - 0.5)) %>% 
    mutate(closest_percentile = case_when(
      percentile == min(percentile, na.rm = T) ~ 'Best trial',
      median_diff == min(median_diff, na.rm = T) ~ 'Median trial',
      percentile == max(percentile, na.rm = T) ~ 'Worst trial')) %>%
    mutate(closest_percentile = factor(closest_percentile, levels = c('Worst trial', 'Median trial', 'Best trial'))) %>% 
    na.omit() 
  
  device.list <- c('FD' = 'ForceDecks', 'AMTI' = 'Laboratory')
  
  df.plot <- df.data %>% 
    select(time_normalised, COPX_AMTI, COPX_FD, COPY_AMTI, COPY_FD, closest_percentile, COPX_RMSE, COPY_RMSE) %>% 
    pivot_longer(c(COPX_AMTI, COPX_FD, COPY_AMTI, COPY_FD, COPX_RMSE, COPY_RMSE), names_to = c('axis', 'device'), names_sep = '_') %>% 
    pivot_wider(names_from = device) %>% 
    pivot_longer(c(AMTI, FD), names_to = 'device') %>% 
    mutate(axis = str_replace_all(axis, c('COPX' = 'Medial-lateral', 'COPY' = 'Anterior-posterior')))  %>% 
    mutate(device = str_replace_all(device, device.list) %>% factor(levels = device.list)) %>% 
    mutate(time_normalised_scaled = scales::rescale(time_normalised, c(0,1)))
  
  ggplot(df.plot) + aes(x = time_normalised_scaled, y = value, color = device, linetype = device) +
    facet_grid(rows = vars(axis), cols = vars(closest_percentile)) +
    geom_line(linewidth = 1) +
    geom_text(data = df.plot %>% filter(time_normalised == 1 & device == 'ForceDecks'), inherit.aes = F, 
              aes(label = paste('RMSE =', round(RMSE,1), ' mm')), 
              x = 0.5, y = Inf, hjust = 0.5, vjust = 1, size = (text.size)/.pt) +
    scale_linetype_manual(values = c('Laboratory' = 'longdash', 'ForceDecks' = 'solid')) +
    scale_x_continuous(breaks = pretty_breaks(5), labels = percent_format()) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(5), limits = c(min(df.plot$value), max(df.plot$value)*1.1)) +
    scale_color_manual(values = cols) +
    ylab('Centre of pressure (mm)') +
    xlab('Time') +
    theme_classic() +
    theme(panel.grid.major = element_line(),
          plot.margin = margin(t = 1),
          strip.background = element_blank(),
          strip.text = element_text(size = text.size+2),
          text = element_text(size = text.size),
          axis.title = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.ticks = element_blank(),
          legend.text = element_text(size = text.size),
          legend.title = element_blank())
}

avgReliabilityWaveformFigures <- function(data, select_test_type) {
  # data = GRF.data
  # select_test_type = 'Countermovement Jump'
  
  df.data <- data %>%
    filter(test_type == select_test_type) %>% 
    select(-Left)  # ONLY USE RIGHT LEG FOR WAVEFORM
  
  # Calculate mean & spread
  df.plot <- df.data %>% 
    group_by(device, day, time_normalised, athlete) %>% 
    summarise(participant_mean = mean(Right)) %>% 
    summarise(force_mean = mean(participant_mean),
              force_sd = sd(participant_mean),
              n = length(participant_mean),                            
              force_se = force_sd/sqrt(n)) %>% 
    ungroup()
  
  # Calculate RMSE
  df.RMSE <- df.data %>% 
    pivot_wider(names_from = day, values_from = Right) %>% 
    group_by(test_type, device, athlete, trial) %>% 
    summarise(RMSE = sqrt(mean((day2 - day1) ^ 2))) %>% 
    na.omit() %>% 
    summarise(participant_mean = mean(RMSE)) %>%
    summarise(RMSE_mean = mean(participant_mean),
              n = length(participant_mean)) %>% 
    mutate(label = paste('RMSE =', round(RMSE_mean,0), 'N'))
  
  # Plot
  ggplot(df.plot) + aes(x = time_normalised, y = force_mean, ymin = force_mean-force_se, ymax = force_mean+force_se) +
    facet_wrap(vars(device)) +
    geom_ribbon(aes(fill = day), alpha = 0.3) +
    geom_line(aes(color = day), linewidth = 1) +
    geom_text(data = df.RMSE, inherit.aes = F, aes(label = label), 
              x = Inf, y = Inf, hjust = 1.1, vjust = 1.4, size = (text.size-1)/.pt) +
    scale_x_continuous(expand = c(0,0), breaks = pretty_breaks(5)) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(5)) +
    scale_color_manual(values = cols) +
    scale_fill_manual(values = cols) +
    ylab('Vertical ground reaction force (N)') +
    xlab('Time') +
    theme_bw() +
    theme(panel.grid = element_blank(),
          plot.margin = margin(t=0, l=0, r=0, b=0),
          strip.background = element_blank(),
          strip.text = element_text(size = text.size),
          panel.border = element_rect(colour = 'grey'),
          text = element_text(size = text.size),
          axis.title = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.text.x = element_blank(),
          axis.ticks = element_blank(),
          legend.text = element_text(size = text.size),
          legend.title = element_blank(),
          legend.position = c(0.1,0.9),
          legend.background = element_rect(fill = 'transparent'))
}

avgValidityWaveformFigures <- function(data, select_test_type) {
  # data = GRF.data
  # select_test_type = 'Shoulder ISO-I'
  
  df.data <- data %>%
    filter(test_type == select_test_type)
  
  # Calculate mean & spread
  df.plot <- df.data %>% 
    group_by(device, time_normalised, athlete) %>% 
    summarise(participant_mean = mean(force),
              n = length(force)) %>% 
    summarise(force_mean = mean(participant_mean),
              force_sd = sd(participant_mean),
              n = length(participant_mean),                            
              force_se = force_sd/sqrt(n)) %>% 
    ungroup()
  
  # Calculate RMSE
  df.RMSE <- df.data %>% 
    pivot_wider(names_from = device, values_from = force) %>% 
    group_by(test_type, day, athlete, trial) %>% 
    summarise(RMSE = sqrt(mean((FD - AMTI) ^ 2))) %>% 
    na.omit() %>% 
    group_by(test_type, athlete) %>% 
    summarise(participant_mean = mean(RMSE),
              n = length(RMSE)) %>%
    summarise(RMSE_mean = mean(participant_mean),
              n = length(participant_mean)) %>% 
    mutate(label = paste('RMSE =', round(RMSE_mean,0), 'N'))
  
  # Plot
  ggplot(df.plot) + aes(x = time_normalised, y = force_mean, ymin = force_mean-force_se, ymax = force_mean+force_se) +
    geom_ribbon(aes(fill = device), alpha = 0.3) +
    geom_line(aes(color = device), linewidth = 1) +
    geom_text(data = df.RMSE, inherit.aes = F, aes(label = label), 
              x = Inf, y = Inf, hjust = 1.1, vjust = 1.4, size = (text.size)/.pt) +
    scale_x_continuous(expand = c(0,0), breaks = pretty_breaks(5)) +
    scale_y_continuous(expand = c(0,0), breaks = pretty_breaks(10)) +
    scale_color_manual(values = cols) +
    scale_fill_manual(values = cols) +
    ylab('Vertical ground reaction force (N)') +
    xlab('Time') +
    theme_classic() +
    theme(panel.grid = element_blank(),
          plot.margin = margin(t=0, l=0, r=0, b=0),
          text = element_text(size = text.size),
          axis.title = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.text.x = element_blank(),
          axis.ticks = element_blank(),
          legend.text = element_text(size = text.size),
          legend.title = element_blank(),
          legend.position = c(0.1,0.9))
}

```

```{r CREATE DISCRETE BLAND ALTMAN}
blandAltmanFigures <- function(data, select_test_type, select_metric) {
  # data = discrete.data
  # select_test_type = 'Squat Assessment'
  # select_metric = 'mean'

  df <- data %>% 
    filter(test_type == select_test_type) %>% 
    pivot_longer(-c(athlete,test_type, device, day, side, rep), names_to = 'metric') %>% 
    pivot_wider(names_from = device) %>% 
    separate(metric, into = c('metric', 'variable'), sep  ='_') %>% 
    filter(metric == select_metric,
           variable == 'force') %>% 
    mutate(differences = FD - AMTI,
           means = (FD + AMTI)/2) 
  
  df.stats <- rmba(data = df,
       measure_one_col = 'AMTI',
       measure_two_col = "FD",
       condition_col = "side",
       id_col = "athlete",
       verbose = FALSE)
  
  df.plot <- tibble(means = df$means,
                    differences = df$differences)
  
  y.max = max(abs(df$differences))
  x.min = min(df$means)*0.97
  x.max = max(df$means)*1.03
  title = if_else(select_metric == 'peak', 'Peak vGRF', 'Mean vGRF')
  
  ggplot(df.plot) + aes(x = means, differences) +
    geom_point(color = '#468B97', alpha = 0.7, size = 2) +
    geom_hline(yintercept = 0) +
    geom_hline(yintercept = df.stats$upper_agreement_limit, linetype = 'longdash') +
    geom_hline(yintercept = df.stats$lower_agreement_limit, linetype = 'longdash') +
    geom_hline(yintercept = df.stats$bias, color = '#EF6262', linewidth = 1) +
    coord_cartesian(clip = 'off') +
    annotate('text', label = 'Upper LOA', x = x.max, y = df.stats$upper_agreement_limit,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$upper_agreement_limit),' N'), x = x.max, y = df.stats$upper_agreement_limit,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = 'Lower LOA', x = x.max, y = df.stats$lower_agreement_limit,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$lower_agreement_limit), ' N'), x = x.max, y = df.stats$lower_agreement_limit,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = 'Mean bias', x = x.max, y = df.stats$bias,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$bias), ' N'), x = x.max, y = df.stats$bias,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = title, x = (x.max+x.min)/2, y = y.max,
             hjust = 0.5, vjust = 0.2, size = title.size/.pt) +
    xlab('Average (N)') +
    ylab('Difference (N)') +
    scale_x_continuous(breaks = pretty_breaks(5), expand = c(0,0), limits = c(x.min,x.max)) +
    scale_y_continuous(breaks = pretty_breaks(8)) +
    theme_minimal() +
    theme(plot.margin = margin(r = 50),
          panel.grid = element_blank(),
          text = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.title = element_text(size = title.size),
          axis.line = element_line())
  
}

blandAltmanCOPFigures <- function(data, select_test_type, select_metric) {
  # data = discrete.data
  # select_test_type = 'Quiet Stand'
  # select_metric = 'mean'

  df.plot <- data %>% 
    filter(test_type == select_test_type) %>% 
    pivot_longer(-c(athlete,test_type, device, day, side, rep), names_to = 'metric') %>% 
    pivot_wider(names_from = device) %>% 
    separate(metric, into = c('metric', 'axis_leg'), sep  ='_') %>% 
    separate(axis_leg, into = c('axis', 'leg'), sep  =' ') %>% 
    filter(metric == select_metric, axis %in% c('COPX','COPY')) %>% 
    mutate(differences = FD - AMTI,
           means = (FD + AMTI)/2) %>% 
    group_nest(axis) %>% 
    mutate(BA = map(data, ~rmba(data = .x,
       measure_one_col = 'AMTI',
       measure_two_col = "FD",
       condition_col = ifelse(select_test_type == 'Quiet Stand', 'side', '1'),
       id_col = "athlete",
       verbose = FALSE))) %>%  
    mutate(plot.data = map(data, ~tibble(means = .x$means, differences = .x$differences))) %>% 
    select(-data) %>% 
    mutate(axis = str_replace_all(axis, c('COPX' = 'Medial-lateral', 'COPY' = 'Anterior-posterior')))

  plot.list <- list()
  for(i in 1:nrow(df.plot)){

    df <- df.plot$plot.data[[i]]
    df.stats <- df.plot$BA[[i]]
  
  y.max = max(abs(df$differences))
  x.min = min(df$means)*0.97
  x.max = max(df$means)*1.03
  title = paste(df.plot$axis[[i]], if_else(select_metric == 'peak', 'peak COP', 'mean COP'))
  
  plot.list[[i]] <- ggplot(df) + aes(x = means, differences) +
    geom_point(color = '#468B97', alpha = 0.7, size = 2) +
    geom_hline(yintercept = 0) +
    geom_hline(yintercept = df.stats$upper_agreement_limit, linetype = 'longdash') +
    geom_hline(yintercept = df.stats$lower_agreement_limit, linetype = 'longdash') +
    geom_hline(yintercept = df.stats$bias, color = '#EF6262', linewidth = 1) +
    coord_cartesian(clip = 'off') +
    annotate('text', label = 'Upper LOA', x = x.max, y = df.stats$upper_agreement_limit,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$upper_agreement_limit),' mm'), x = x.max, y = df.stats$upper_agreement_limit,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = 'Lower LOA', x = x.max, y = df.stats$lower_agreement_limit,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$lower_agreement_limit), ' mm'), x = x.max, y = df.stats$lower_agreement_limit,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = 'Mean bias', x = x.max, y = df.stats$bias,
             hjust = 0, vjust = -0.4, size = text.size/.pt) +
    annotate('text', label = paste0(sprintf('%.1f', df.stats$bias), ' mm'), x = x.max, y = df.stats$bias,
             hjust = 0, vjust = 1.4, size = text.size/.pt) +
    annotate('text', label = title, x = (x.max+x.min)/2, y = y.max,
             hjust = 0.5, vjust = 0.2, size = title.size/.pt) +
    xlab('Average (mm)') +
    ylab('Difference (mm)') +
    scale_x_continuous(breaks = pretty_breaks(5), limits = c(x.min, x.max), expand = c(0,0)) +
    scale_y_continuous(breaks = pretty_breaks(8)) +
    theme_minimal() +
    theme(plot.margin = margin(r = 50),
          panel.grid = element_blank(),
          text = element_text(size = text.size),
          axis.text = element_text(size = text.size),
          axis.title = element_text(size = title.size),
          axis.line = element_line())
  
  }
  
  wrap_plots(plot.list) + plot_layout(nrow = 1)
  
}
```

<div class="credits">
<p class ='tight' style="color: white;">Report by Tyler Collings</p>
<img src="images/griffith_logo.png" alt="Griffith Logo" class="griffith_logo">
</div>

Study information
=====================================

Row {data-height=350}
-------------------------------------
<div style="text-align: center;">
<strong style="font-size: 20px;">Concurrent validity and test-retest reliability of VALD ForceDecks strength, balance, and movement assessment tasks</strong>

Original Research published in Journal of Science and Medicine (May 2024)
DOI: <a href="https://doi.org/10.1016/j.jsams.2024.04.014">https://doi.org/10.1016/j.jsams.2024.04.014</a>

Tyler J. Collings^1,2^ PhD , Yuri Lopes Lima^1,2^ MSc, Benjamin Dutallis^1,2^ AEP, Matthew N. Bourne^1,2^ PhD 

^1^School of Health Sciences and Social Work, Griffith University, Gold Coast Campus, QLD, Australia.  
^2^Griffith Centre of Biomedical and Rehabilitation Engineering (GCORE), Menzies Health Institute Queensland, Australia. 

<img src="images/GU_logo.png" alt="Griffith University logo" height="48"/>
<img src="images/GCORE_logo.png" alt="GCORE logo" height="48"/>

<b>Corresponding author:</b> Dr Tyler Collings  
1 Parklands Drive, Griffith University, Gold Coast, Southport 4215, QLD, Australia.  
Email: <a href="mailto:t.collings@griffith.edu.au">t.collings@griffith.edu.au</a>  

<b>Funding Declaration:</b> Funding was provided by VALD to cover the cost of data collection, analysis, and reporting of data. Data analysis was performed independently of VALD.
</div>  
  
Row
-------------------------------------
### Participants
**Inclusion/exclusion criteria**  
Participants included 16 healthy individuals recruited from a population of Australian University students. To be included, participants were required to be aged between 18-40 years, physically active multiple times per week (30+ minutes), and free from any current injuries or neurological conditions that may influence the ability to perform tests, any major injuries in the previous 1-2 months that may influence test results, and any current shoulder pain or instability, or lower back pain. All participants were encouraged to refrain from performing resistance training or intense physical activity on the day before testing.

**Ethics**  
All participants provided written informed consent prior to data collection. Study ethics were approved by the Griffith University Human Research Ethics Committee (GU reference: 2023/208). 

**Participant characteristics**  
Anthropometric measures for 16 participants. 10/16 (63%) participants were male and 6/16 (38%) were female. All participants except 1 were right-leg dominant.
```{r, fig.align='left'}
gt(participant.table, rowname_col = 'name') %>% 
  fmt_number(
    decimals = 1) %>% 
  cols_align(
    align = 'center') %>% 
  tab_options(
    table.font.size = text.size+5
  )

```

### Equipment setup
Data were collected at the Griffith University motion laboratory, Gold Coast, Australia.  

**Force plates**  
Force plate data were acquired from the ForceDecks (FDLite, V.2, VALD, Brisbane, Australia) positioned on top of a tri-axial force plate embedded in the laboratory floor (AMTI, MA, United States). This arrangement enabled vertical ground reaction forces and centre of pressure to be measured from the ForceDecks as well as gold-standard laboratory-quality force plates simultaneously. Both force plates recorded data at 1000 Hz.
 
Before commencing testing, a weighted plate was used to determine the agreement in vertical ground reaction force between systems under static conditions, indicating a <1-2N difference between force plates. 

The ForceDecks were operated using the iOS application (V.1.8.9) on an iPad (Apple, CA, United States) and the laboratory force plates were connected to VALD ForceDecks software for Windows (Microsoft, WA, United States).  

**Force plate arrangement**  
<img src="images/forceplate_setup.png" alt="Force plate setup" width="350"/>

### Data collection
Participants attended two identically structured testing sessions approximately 7 days apart. A 5-minute warm-up was performed on a stationary cycle ergometry at a self-selected moderate intensity to increase core-body temperature and dynamic stretching. 

**Tasks**  
12 standard tests available in the ForceDecks software were performed in a pre-defined order:   
1) Quiet Stand  
2) Single Leg Range of Stability  
3) Squat Assessment  
4) Countermovement Jump  
5) Squat Jump  
6) Drop Jump  
7) Hop Test  
8) Single Leg Hop Test  
9) Shoulder ISO-I  
10) Shoulder ISO-Y  
11) Shoulder ISO-T  
12) Isometric Mid-Thigh Pull  

**Task protocols**  
All tests were performed in accordance with the protocol and instructions outlined on the VALD Knowledge Base website. Participant's were shown how to perform each test and were given a chance to practice until they demonstrated satisfactory performance. Both force plates were ‘zeroed’ before beginning each trial. The participants weight was recorded in a stationary and relaxed standing position. Each repetition began and ended with 2-3 seconds of quiet standing. A total of 3 repetitions of each test were performed, with the unilateral task performed with 3 trials on the right followed by the left leg. Approximately 20-30 seconds rest was provided between repetitions of a task and 1-2 minutes rest between tasks.

Row
-------------------------------------
### Data analysis
Force-time data from both force plates were automatically processed using the ForceDecks application for Windows, including the identification of movement phases and calculation of metrics. Trials were inspected for any errors in participant weighing or trial auto-detection and were corrected using the software re-analyse tool where possible. All force plate metrics were exported for analysis in R Studio (R version 4.3.0).  

**Reliabilty**  
Test-retest reliability of metrics between days (1 week apart) was assessed with intraclass coefficients (ICC) using a two-way random effects model, absolute agreement, and multiple measurements (ICC2,k, where k is the mean of 3 repetitions). ICC values were interpreted as less than 0.5 = poor reliability, 0.5-0.75 = moderate reliability, 0.75-0.9 = good reliability, and values greater than 0.90 indicated excellent reliability <a href="#ref">[1]</a>. Measurement variability or consistency within a subject was quantified using standard error of measurement (SEM), where SEM=SD√(1-ICC) [2]. The minimal detectable change (MDC) or smallest real difference between two testing time points was calculated using the SEM and the 95% confidence interval for detecting a change in scores beyond 0, where MDC=1.96 × √2  ×SEM <a href="#ref">[2]</a>. 

**Validity**   
To enable concurrent validation of ground reaction forces and centre of pressure independent of weighing and movement phase detection, time series data over the entire movement were cross-correlated and time-adjusted. Due to differences in origin location between force plates, the centre of pressure was centred around 0 by subtracting the mean of the time series data for both force plate systems. <strong>Note:</strong> The stacked arrangement of force plates is not a perfect method for assessing concurrent validity with some discrepancies in force/centre of pressure occurring during impact or at extreme ranges. A small number of trials were removed due to errors created by stacking forceplates.     

The validity of metrics was assessed using the percentage difference compared to the laboratory forceplates. Where <5% was interpreted as excellent validity, 5-10% was good validity, 10-20% was moderate validity, and 20% + was poor validity. Bland-Altman 95% limits of agreement for metrics are also presented. Validity of force and centre of pressure data was assessed between force plates over the duration of the movement using root mean square error (RMSE). To visualise the agreement between forceplates, individual trials ranging from the worst (lowest RMSE), and average (mean RMSE), to the best (highest RMSE) were displayed. The overall agreement for all trials was assessed using Bland-Altman plots for the mean ground reaction force, with mean bias and limits of agreement between force plates <a href="#ref">[3]</a>.  

Row
-------------------------------------

### References
<p id="ref">
1.	Koo, T.K. and M.Y. Li, A guideline of selecting and reporting intraclass correlation coefficients for reliability research. Journal of chiropractic medicine, 2016. 15(2): p. 155-163. DOI: <a href="https://doi.org/10.1016/j.jcm.2016.02.012">https://doi.org/10.1016/j.jcm.2016.02.012</a>  

2.	Beckerman, H., et al., Smallest real difference, a link between reproducibility and responsiveness. Quality of Life Research, 2001. 10: p. 571-578. DOI: <a href="https://doi.org/10.1023/A:1013138911638">https://doi.org/10.1023/A:1013138911638</a> 
</p>  

3. Bland, J. M., & Altman, D. (1986). Statistical methods for assessing agreement between two methods of clinical measurement. The lancet, 327(8476), 307-310. DOI: <a href="https://doi.org/10.1016/S0140-6736(86)90837-8">https://doi.org/10.1016/S0140-6736(86)90837-8</a>   

Countermovement jump
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/countermovement_jump.png")
```

### Reliability (repeatability between-days)
```{r, fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Countermovement Jump")
```

### Validity (agreement with lab forceplate)
```{r, fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Countermovement Jump")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Countermovement Jump")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate
```{r, fig.height=3, fig.width=5}
summarySwarm(reliability_validity, "Countermovement Jump")
```

### Validity: Bland-Altman agreement between force plates
```{r, fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Countermovement Jump", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Countermovement Jump"]]}
htmltools::div(style='overflow-x: scroll', metricTable(reliability_validity, "Countermovement Jump"))
```

Squat Jump
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/squat_jump.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Squat Jump")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Squat Jump")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Squat Jump")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Squat Jump") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Squat Jump", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Squat Jump"]]}
metricTable(reliability_validity, "Squat Jump")
```


Drop Jump
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/drop_vertical_jump.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Drop Jump")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Drop Jump")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Drop Jump")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Drop Jump") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Drop Jump", 'mean')

```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Drop Jump"]]}
metricTable(reliability_validity, "Drop Jump")
```


Hop Test
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/hop_test.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Hop Test")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Hop Test")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Hop Test")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Hop Test") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Hop Test", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Hop Test"]]}
metricTable(reliability_validity, "Hop Test")
```


Single Leg Hop Test
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/single_leg_hop_test.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Single Leg Hop Test")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Single Leg Hop Test")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Single Leg Hop Test")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Single Leg Hop Test") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Single Leg Hop Test", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Single Leg Hop Test"]]}
metricTable(reliability_validity, "Single Leg Hop Test")
```


Isometric Mid-Thigh Pull
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/isometric_mid_thigh_pull.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Isometric Mid-Thigh Pull")
```

### Reliability compared to lab forceplate 
```{r,  fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Isometric Mid-Thigh Pull") 
```

Row {data-height=500}
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Isometric Mid-Thigh Pull"]]}
metricTable(reliability_validity, "Isometric Mid-Thigh Pull") %>% 
  cols_hide(c(PDiff_group, PDiff))
```

Shoulder ISO-I
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/shoulder_iso_i.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Shoulder ISO-I")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Shoulder ISO-I")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Shoulder ISO-I")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Shoulder ISO-I") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Shoulder ISO-I", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Shoulder ISO-I"]]}
metricTable(reliability_validity, "Shoulder ISO-I")
```

Shoulder ISO-T
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/shoulder_iso_t.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Shoulder ISO-T")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Shoulder ISO-T")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Shoulder ISO-T")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Shoulder ISO-T") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3.2, fig.width=5}
blandAltmanFigures(discrete.data,"Shoulder ISO-T", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Shoulder ISO-T"]]}
metricTable(reliability_validity, "Shoulder ISO-T")
```

Shoulder ISO-Y
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/shoulder_iso_Y.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Shoulder ISO-Y")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Shoulder ISO-Y")
```

Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Shoulder ISO-Y")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Shoulder ISO-Y") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Shoulder ISO-Y", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Shoulder ISO-Y"]]}
metricTable(reliability_validity, "Shoulder ISO-Y")
```


Squat Assessment
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/squat_assessment.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Squat Assessment")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Squat Assessment")
```


Row {data-height=380}
-------------------------------------

### Validity: time-series comparison between force plates
```{r, fig.height=3.2, fig.width=10}
individualWaveformFigures(GRF.data, "Squat Assessment")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=5} 
summarySwarm(reliability_validity, "Squat Assessment") 
```

### Validity: Bland-Altman agreement between force plates
```{r fig.height=3, fig.width=5}
blandAltmanFigures(discrete.data,"Squat Assessment", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Squat Assessment"]]}
metricTable(reliability_validity, "Squat Assessment")
```


Quiet Stand
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/quiet_stand.png")
```

### Reliability (repeatability between-days)
```{r, fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Quiet Stand")
```

### Validity (agreement with lab force plates)
```{r, fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Quiet Stand")
```


Row {data-height=500}
-------------------------------------

### Centre of pressure Validity: comparison between force plates
```{r, fig.width=12}
individualCOPFigures(GRF.data, "Quiet Stand")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=4} 
summarySwarm(reliability_validity, "Quiet Stand") 
```

### Centre of pressure validity: agreement between force plates
```{r, fig.height=3, fig.width=8}
blandAltmanCOPFigures(discrete.data,"Quiet Stand", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Quiet Stand"]]}
metricTable(reliability_validity, "Quiet Stand")
```


Single Leg Range of Stability
=====================================

Row {data-height=300}
-------------------------------------
### Task
```{r echo=FALSE, fig.width=3.9}
knitr::include_graphics("images/single_leg_range_of_stability.png")
```

### Reliability (repeatability between-days)
```{r,  fig.height=3, fig.width=5}
summaryReliabiltyBar(reliability_validity, "Single Leg Range of Stability")
```

### Validity (agreement with lab force plates)
```{r,  fig.height=3, fig.width=5}
summaryValidityBar(reliability_validity, "Single Leg Range of Stability")
```

Row {data-height=500}
-------------------------------------

### Centre of pressure Validity: comparison between force plates
```{r, fig.width=12}
individualCOPFigures(GRF.data, "Single Leg Range of Stability")
```

Row {data-height=300}
-------------------------------------

### Reliability compared to lab forceplate 
```{r, fig.height=3, fig.width=4} 
summarySwarm(reliability_validity, "Single Leg Range of Stability") 
```

### Centre of pressure validity: agreement between force plates
```{r fig.height=3, fig.width=8}
blandAltmanCOPFigures(discrete.data,"Single Leg Range of Stability", 'mean')
```

Row
-------------------------------------

### Reliability & validity of metrics
```{r fig.height=table.height[["Single Leg Range of Stability"]]}
metricTable(reliability_validity, "Single Leg Range of Stability")
```

